var cov_11kf0gadt7=function(){var path="/Users/desimiramitkova/Projects/etherlime/cli-commands/compiler/vyper-compiler/vyper-compiler.js";var hash="78f074b91295c9c6ecfc7792d918be0704c0df55";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/desimiramitkova/Projects/etherlime/cli-commands/compiler/vyper-compiler/vyper-compiler.js",statementMap:{"0":{start:{line:1,column:18},end:{line:1,column:42}},"1":{start:{line:2,column:15},end:{line:2,column:37}},"2":{start:{line:3,column:13},end:{line:3,column:28}},"3":{start:{line:4,column:11},end:{line:4,column:24}},"4":{start:{line:5,column:15},end:{line:5,column:32}},"5":{start:{line:7,column:24},end:{line:7,column:62}},"6":{start:{line:9,column:12},end:{line:36,column:1}},"7":{start:{line:11,column:4},end:{line:11,column:47}},"8":{start:{line:13,column:4},end:{line:34,column:5}},"9":{start:{line:13,column:17},end:{line:13,column:18}},"10":{start:{line:14,column:8},end:{line:33,column:9}},"11":{start:{line:15,column:27},end:{line:15,column:84}},"12":{start:{line:16,column:31},end:{line:16,column:71}},"13":{start:{line:17,column:38},end:{line:17,column:76}},"14":{start:{line:19,column:12},end:{line:21,column:13}},"15":{start:{line:20,column:16},end:{line:20,column:22}},"16":{start:{line:23,column:32},end:{line:23,column:57}},"17":{start:{line:24,column:12},end:{line:24,column:55}},"18":{start:{line:26,column:33},end:{line:26,column:91}},"19":{start:{line:28,column:12},end:{line:28,column:70}},"20":{start:{line:31,column:12},end:{line:31,column:54}},"21":{start:{line:32,column:12},end:{line:32,column:20}},"22":{start:{line:39,column:31},end:{line:42,column:1}},"23":{start:{line:40,column:16},end:{line:40,column:37}},"24":{start:{line:41,column:4},end:{line:41,column:49}},"25":{start:{line:45,column:22},end:{line:57,column:1}},"26":{start:{line:48,column:4},end:{line:52,column:5}},"27":{start:{line:49,column:8},end:{line:49,column:83}},"28":{start:{line:51,column:8},end:{line:51,column:19}},"29":{start:{line:54,column:4},end:{line:54,column:33}},"30":{start:{line:56,column:4},end:{line:56,column:52}},"31":{start:{line:60,column:16},end:{line:69,column:1}},"32":{start:{line:62,column:15},end:{line:62,column:103}},"33":{start:{line:64,column:25},end:{line:64,column:45}},"34":{start:{line:65,column:4},end:{line:65,column:90}},"35":{start:{line:66,column:4},end:{line:66,column:50}},"36":{start:{line:68,column:4},end:{line:68,column:25}},"37":{start:{line:71,column:29},end:{line:80,column:1}},"38":{start:{line:73,column:4},end:{line:75,column:5}},"39":{start:{line:74,column:8},end:{line:74,column:36}},"40":{start:{line:77,column:19},end:{line:77,column:20}},"41":{start:{line:78,column:4},end:{line:78,column:123}},"42":{start:{line:83,column:0},end:{line:83,column:21}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:9,column:12},end:{line:9,column:13}},loc:{start:{line:9,column:48},end:{line:36,column:1}},line:9},"1":{name:"(anonymous_1)",decl:{start:{line:39,column:31},end:{line:39,column:32}},loc:{start:{line:39,column:51},end:{line:42,column:1}},line:39},"2":{name:"(anonymous_2)",decl:{start:{line:45,column:22},end:{line:45,column:23}},loc:{start:{line:45,column:83},end:{line:57,column:1}},line:45},"3":{name:"(anonymous_3)",decl:{start:{line:60,column:16},end:{line:60,column:17}},loc:{start:{line:60,column:71},end:{line:69,column:1}},line:60},"4":{name:"(anonymous_4)",decl:{start:{line:71,column:29},end:{line:71,column:30}},loc:{start:{line:71,column:65},end:{line:80,column:1}},line:71}},branchMap:{"0":{loc:{start:{line:19,column:12},end:{line:21,column:13}},type:"if",locations:[{start:{line:19,column:12},end:{line:21,column:13}},{start:{line:19,column:12},end:{line:21,column:13}}],line:19},"1":{loc:{start:{line:41,column:12},end:{line:41,column:38}},type:"binary-expr",locations:[{start:{line:41,column:12},end:{line:41,column:23}},{start:{line:41,column:27},end:{line:41,column:38}}],line:41},"2":{loc:{start:{line:73,column:4},end:{line:75,column:5}},type:"if",locations:[{start:{line:73,column:4},end:{line:75,column:5}},{start:{line:73,column:4},end:{line:75,column:5}}],line:73}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0},b:{"0":[0,0],"1":[0,0],"2":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184",hash:"78f074b91295c9c6ecfc7792d918be0704c0df55"};var coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}return coverage[path]=coverageData;}();const dockerCLI=(cov_11kf0gadt7.s[0]++,require('docker-cli-js'));const docker=(cov_11kf0gadt7.s[1]++,new dockerCLI.Docker());const path=(cov_11kf0gadt7.s[2]++,require("path"));const fs=(cov_11kf0gadt7.s[3]++,require("fs"));const mkdirp=(cov_11kf0gadt7.s[4]++,require("mkdirp"));const VYPER_EXTENSION=(cov_11kf0gadt7.s[5]++,require('./config.js').VYPER_EXTENSION);cov_11kf0gadt7.s[6]++;const run=async(allFiles,buildDirectory)=>{cov_11kf0gadt7.f[0]++;cov_11kf0gadt7.s[7]++;await docker.command("pull ethereum/vyper");cov_11kf0gadt7.s[8]++;for(let i=(cov_11kf0gadt7.s[9]++,0);i<allFiles.length;i++){cov_11kf0gadt7.s[10]++;try{let filePath=(cov_11kf0gadt7.s[11]++,path.normalize(path.relative(process.cwd(),allFiles[i])));//extract pure file path
let fileBaseName=(cov_11kf0gadt7.s[12]++,path.basename(filePath,VYPER_EXTENSION));let fileTimestampStatus=(cov_11kf0gadt7.s[13]++,await getFileTimestampStatus(filePath));cov_11kf0gadt7.s[14]++;if(!(await isFileUpdated(fileBaseName,fileTimestampStatus,buildDirectory))){cov_11kf0gadt7.b[0][0]++;cov_11kf0gadt7.s[15]++;return;}else{cov_11kf0gadt7.b[0][1]++;}const displayPath=(cov_11kf0gadt7.s[16]++,'.'+path.sep+filePath);cov_11kf0gadt7.s[17]++;console.log(`Compiling ${displayPath}...`);let compiledObject=(cov_11kf0gadt7.s[18]++,await compile(filePath,fileBaseName,fileTimestampStatus));cov_11kf0gadt7.s[19]++;await recordCompiledObject(compiledObject,buildDirectory);}catch(e){cov_11kf0gadt7.s[20]++;console.error('Vyper compilation failed.');cov_11kf0gadt7.s[21]++;throw e;}}};//gets timestamp indicating the last time the file was changed or modified
cov_11kf0gadt7.s[22]++;const getFileTimestampStatus=async filePath=>{cov_11kf0gadt7.f[1]++;let stats=(cov_11kf0gadt7.s[23]++,fs.statSync(filePath));cov_11kf0gadt7.s[24]++;return((cov_11kf0gadt7.b[1][0]++,stats.ctime)||(cov_11kf0gadt7.b[1][1]++,stats.mtime)).getTime();};//checks if file was changed or modified since once compiled
cov_11kf0gadt7.s[25]++;const isFileUpdated=async(fileBaseName,fileTimestampStatus,buildDirectory)=>{cov_11kf0gadt7.f[2]++;let current;cov_11kf0gadt7.s[26]++;try{cov_11kf0gadt7.s[27]++;current=fs.readFileSync(`${buildDirectory}/${fileBaseName}.json`,'utf8');}catch(e){cov_11kf0gadt7.s[28]++;return true;}cov_11kf0gadt7.s[29]++;current=JSON.parse(current);cov_11kf0gadt7.s[30]++;return current.updatedAt<fileTimestampStatus;};cov_11kf0gadt7.s[31]++;const compile=async(filePath,fileBaseName,fileTimestampStatus)=>{cov_11kf0gadt7.f[3]++;let data=(cov_11kf0gadt7.s[32]++,await docker.command(`run  -v $(pwd):/code ethereum/vyper -f combined_json ${filePath}`));let compiledObject=(cov_11kf0gadt7.s[33]++,JSON.parse(data.raw));cov_11kf0gadt7.s[34]++;compiledObject=Object.assign({contractName:fileBaseName},compiledObject[filePath]);//restructuring the compiled object
cov_11kf0gadt7.s[35]++;compiledObject.updatedAt=fileTimestampStatus;cov_11kf0gadt7.s[36]++;return compiledObject;};cov_11kf0gadt7.s[37]++;const recordCompiledObject=(compiledObject,buildDirectory)=>{cov_11kf0gadt7.f[4]++;cov_11kf0gadt7.s[38]++;if(!fs.existsSync(buildDirectory)){cov_11kf0gadt7.b[2][0]++;cov_11kf0gadt7.s[39]++;mkdirp.sync(buildDirectory);}else{cov_11kf0gadt7.b[2][1]++;}const spaces=(cov_11kf0gadt7.s[40]++,2);// number of space characters to be inserted for readability purposes
cov_11kf0gadt7.s[41]++;fs.writeFileSync(`${buildDirectory}/${compiledObject.contractName}.json`,JSON.stringify(compiledObject,null,spaces));//second param is a string replacer if needed
};cov_11kf0gadt7.s[42]++;module.exports=run;